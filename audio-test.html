<!DOCTYPE html>
<html>
<head>
    <title>Queue Audio Test</title>
    <meta charset="UTF-8">
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f0f0f0;
        }
        .test-button {
            background: #dc2626;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
            display: block;
            width: 100%;
        }
        .test-button:hover {
            background: #b91c1c;
        }
        .result {
            background: white;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
        }
        h1 {
            color: #dc2626;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>🚨 Queue Audio Test Center 🚨</h1>
    <p>Use these buttons to test different audio notification methods:</p>
    
    <button class="test-button" onclick="testBasicAudio()">
        🔊 Test Basic Audio (alarm.wav)
    </button>
    
    <button class="test-button" onclick="testExternalPlayer()">
        🎵 Test External Audio Player Window
    </button>
    
    <button class="test-button" onclick="testEmergencyAudio()">
        🚨 Test Emergency Audio (Python Script)
    </button>
    
    <button class="test-button" onclick="testAllMethods()">
        ⚡ Test ALL Methods (Nuclear Option)
    </button>
    
    <button class="test-button" onclick="enableAudioFirst()">
        👆 Enable Audio Permissions (Do This First!)
    </button>
    
    <div id="results"></div>
    
    <script>
        let userInteracted = false;
        
        function logResult(message) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = 'result';
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            results.appendChild(div);
            console.log(message);
        }
        
        function enableAudioFirst() {
            logResult('🔧 Enabling audio permissions...');
            
            // Create and play a silent audio to unlock audio context
            const audio = new Audio();
            audio.src = 'data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+H2u2oiByOLzPTOeTUFLYHC6tOGOAcCY7Xq4ptMEw1Qu+X4wHEeACCMzvXQeDkGH3rC6tOGOggAZ7Tr5Z5NEAxPqeP4wXIjBR6HzfTNeTQFLYHC6tOGNwcCY7Xq4ppMEgxPqeH2wmseASKLyfXOezQGK3/B6tOHOQcCYrXq4ppMEwxPqeL1wW0fASCEzfTNeSMFLYDC6tOGOQgAZrPr5JxNEwxPqeP4wW8dASWPzvfPhzUGK3vG5tOIOQgAZrPq5JxNEwxQqOH2wm0eBSCEzfXOejMGLH/A6tOGOQcBYrXq4ppNEw1Qu+P1wWwfASKKzfPOejEGLYDB6tOGOAcBYrXq4ppMEwxPqeL3wm0dASGEzfTOeCEGLYDA6tOGOQgAZrTq5JxNEwxPqeH3wm0eBSCEzfTOcyEGLYDB6tOGOQcBYrXq4ppMEwxPqeL3wm0dASGEzfTOeCEGLYDA6tOGOQgAZrTq5JxNEwxPqeH3wm0eBSCEzfTOcyEGLYDB6tOGOQcBYrXq4ppMEwxPqeL3wm0dASGEzfTOeCEGLYDA6tOGOQgAZrTq5JxNEwxPqeH3wm0eBSCEzfTOcyEGLYDB6tOGOQcBYrXq4ppMEwxPqeL3wm0dASGEzfTOeCEGLYDA6tOGOQgAZrTq5JxNEwxPqeH3wm0eBSCEzfTOcyEGLYDB6tOGOQcBYrXq4ppMEwxPqeL3wm0dASGEzfTOeCEGLYDA6tOGOQgAZrTq5JxNEwxPqeH3wm0eBSCEzfTOcyEGLYDB6tOGOQcBYrXq4ppMEwxPqeL3wm0dASGEzfTOeCEGLYDA6tOGOQgAZrTq5JxNEwxPqeH3wm0eBSCEzfTOcyEGLYDB6tOGOQcBYrXq4ppMEwxPqeL3wm0dASGEzfTOeCEGLYDA6tOGOQgAZrTq5JxNEwxPqeH3wm0eBSCEzfTOcyEGLYDB6tOGOQc=';
            audio.volume = 0.01;
            audio.play().then(() => {
                logResult('✅ Audio permissions enabled successfully!');
                userInteracted = true;
            }).catch(e => {
                logResult(`❌ Failed to enable audio: ${e.message}`);
            });
        }
        
        function testBasicAudio() {
            logResult('🔊 Testing basic audio...');
            
            const audio = new Audio('Sounds/alarm.wav');
            audio.volume = 1.0;
            audio.play().then(() => {
                logResult('✅ Basic audio played successfully!');
            }).catch(e => {
                logResult(`❌ Basic audio failed: ${e.message}`);
                // Try MP3 fallback
                const audioMp3 = new Audio('Sounds/alarm.mp3');
                audioMp3.volume = 1.0;
                audioMp3.play().then(() => {
                    logResult('✅ MP3 fallback played successfully!');
                }).catch(e2 => {
                    logResult(`❌ MP3 fallback also failed: ${e2.message}`);
                });
            });
        }
        
        function testExternalPlayer() {
            logResult('🎵 Opening external audio player window...');
            
            try {
                const audioWindow = window.open(
                    'audio-player.html?number=TEST',
                    'audioPlayer',
                    'width=800,height=600,left=100,top=100,resizable=yes,scrollbars=yes'
                );
                
                if (audioWindow) {
                    audioWindow.focus();
                    logResult('✅ External audio player opened successfully!');
                } else {
                    logResult('❌ Failed to open external audio player (popup blocked?)');
                }
            } catch (e) {
                logResult(`❌ External player error: ${e.message}`);
            }
        }
        
        function testEmergencyAudio() {
            logResult('🚨 Triggering emergency audio (Python script)...');
            
            fetch('/emergency-audio', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    queue_number: 'TEST'
                })
            }).then(response => response.json())
            .then(result => {
                if (result.success) {
                    logResult('✅ Emergency audio triggered successfully!');
                } else {
                    logResult(`❌ Emergency audio failed: ${result.error}`);
                }
            }).catch(e => {
                logResult(`❌ Emergency audio request failed: ${e.message}`);
            });
        }
        
        function testAllMethods() {
            logResult('⚡ NUCLEAR OPTION: Testing ALL methods...');
            
            // Test 1: Basic audio
            setTimeout(() => testBasicAudio(), 500);
            
            // Test 2: External player
            setTimeout(() => testExternalPlayer(), 1500);
            
            // Test 3: Emergency audio
            setTimeout(() => testEmergencyAudio(), 2500);
            
            // Test 4: Web Audio API beep
            setTimeout(() => {
                logResult('🎵 Testing Web Audio API beep...');
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = 880;
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 2);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 2);
                    
                    logResult('✅ Web Audio API beep triggered!');
                } catch (e) {
                    logResult(`❌ Web Audio API beep failed: ${e.message}`);
                }
            }, 3500);
            
            // Test 5: Alert dialog
            setTimeout(() => {
                logResult('📢 Showing alert dialog...');
                alert('🚨 TEST ALERT! 🚨\n\nThis is a test of the emergency alert system!');
                logResult('✅ Alert dialog shown!');
            }, 4500);
        }
        
        // Add click listener to enable audio on any interaction
        document.addEventListener('click', () => {
            if (!userInteracted) {
                enableAudioFirst();
            }
        });
    </script>
</body>
</html>
