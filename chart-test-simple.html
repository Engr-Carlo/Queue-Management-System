<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simple Chart Test - Queue Management</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="config.js"></script>
  <style>
    body {
      margin: 20px;
      font-family: Arial, sans-serif;
    }
    .chart-container {
      width: 900px;
      height: 400px;
      margin: 20px auto;
      padding: 20px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background: white;
    }
    #queueChart {
      max-height: 350px;
    }
    .legend {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
      justify-content: center;
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .legend-color {
      width: 16px;
      height: 16px;
      border-radius: 50%;
    }
  </style>
</head>
<body>
    <h1>🏢 Queue Management Analytics - Direct Test</h1>
    <p>Testing the chart implementation without authentication.</p>
    
    <div class="chart-container">
        <h3>📊 Queue Volume Analytics</h3>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #ef4444;"></div>
                <span>Dean's Office</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #3b82f6;"></div>
                <span>IE Department</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #10b981;"></div>
                <span>CPE Department</span>
            </div>
        </div>
        
        <canvas id="queueChart"></canvas>
    </div>
    
    <button onclick="loadRealChartData()">🔄 Refresh Chart Data</button>
    <button onclick="testWithSampleData()">📊 Test with Sample Data</button>
    
    <script>
        let queueChart = null;
        
        // Initialize Chart - ULTRA SIMPLE VERSION
        function initializeChart() {
            const ctx = document.getElementById('queueChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (queueChart) {
                queueChart.destroy();
            }
            
            // Create the most basic line chart possible
            queueChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['12:00 AM', '1:00 AM', '2:00 AM', '3:00 AM', '4:00 AM', '5:00 AM', '6:00 AM', '7:00 AM'],
                    datasets: [
                        {
                            label: "Dean's Office",
                            data: [0, 0, 0, 0, 0, 2, 5, 3],
                            borderColor: '#ef4444',
                            backgroundColor: 'transparent',
                            fill: false,
                            pointRadius: 0,
                            pointHoverRadius: 0,
                            tension: 0
                        },
                        {
                            label: 'IE Department', 
                            data: [0, 0, 0, 0, 1, 3, 7, 4],
                            borderColor: '#3b82f6',
                            backgroundColor: 'transparent',
                            fill: false,
                            pointRadius: 0,
                            pointHoverRadius: 0,
                            tension: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Time'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Number of Queues'
                            },
                            beginAtZero: true
                        }
                    },
                    elements: {
                        point: {
                            radius: 0,
                            hoverRadius: 0
                        }
                    }
                }
            });
            
            console.log('Basic chart initialized successfully');
        }
        
        // Update chart with new data - ULTRA SIMPLE VERSION
        function updateChart(data) {
            if (!queueChart) {
                console.error('Chart not initialized');
                return;
            }
            
            console.log('Updating chart with data:', data);
            
            // Simple direct update
            queueChart.data.labels = data.labels || [];
            queueChart.data.datasets = data.datasets || [];
            
            // Make sure all datasets have no points
            queueChart.data.datasets.forEach(dataset => {
                dataset.pointRadius = 0;
                dataset.pointHoverRadius = 0;
                dataset.fill = false;
            });
            
            queueChart.update();
            
            console.log('Chart updated successfully with', data.labels?.length, 'labels and', data.datasets?.length, 'datasets');
        }
        
        // Load real queue data for chart - ULTRA SIMPLE VERSION
        async function loadRealChartData() {
            console.log('Attempting to load real chart data...');
            
            try {
                const response = await fetch(`${API_BASE_URL}/analytics/hourly-queue-data`);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('Real data received from backend:', data);
                    updateChart(data);
                    return;
                } else {
                    console.log('Backend not available, status:', response.status);
                }
            } catch (error) {
                console.log('Error connecting to backend:', error);
            }
            
            // Fallback data if backend is not available
            const fallbackData = {
                labels: ['12:00 AM', '1:00 AM', '2:00 AM', '3:00 AM', '4:00 AM', '5:00 AM', '6:00 AM', '7:00 AM'],
                datasets: [
                    {
                        label: "Dean's Office",
                        data: [0, 0, 0, 0, 0, 2, 5, 3],
                        borderColor: '#ef4444',
                        backgroundColor: 'transparent',
                        fill: false,
                        pointRadius: 0,
                        pointHoverRadius: 0
                    },
                    {
                        label: 'IE Department',
                        data: [0, 0, 0, 0, 1, 3, 7, 4],
                        borderColor: '#3b82f6',
                        backgroundColor: 'transparent',
                        fill: false,
                        pointRadius: 0,
                        pointHoverRadius: 0
                    }
                ]
            };
            
            console.log('Using fallback data:', fallbackData);
            updateChart(fallbackData);
        }
        
        // Test with different sample data
        function testWithSampleData() {
            const sampleData = {
                labels: ['12:00 AM', '1:00 AM', '2:00 AM', '3:00 AM', '4:00 AM', '5:00 AM', '6:00 AM', '7:00 AM', '8:00 AM'],
                datasets: [
                    {
                        label: "Dean's Office",
                        data: [0, 1, 0, 2, 1, 4, 7, 5, 3],
                        borderColor: '#ef4444',
                        backgroundColor: 'transparent',
                        fill: false,
                        pointRadius: 0,
                        pointHoverRadius: 0
                    },
                    {
                        label: 'IE Department',
                        data: [1, 0, 1, 1, 3, 5, 9, 6, 4],
                        borderColor: '#3b82f6',
                        backgroundColor: 'transparent',
                        fill: false,
                        pointRadius: 0,
                        pointHoverRadius: 0
                    },
                    {
                        label: 'CPE Department',
                        data: [0, 0, 0, 1, 1, 2, 4, 3, 2],
                        borderColor: '#10b981',
                        backgroundColor: 'transparent',
                        fill: false,
                        pointRadius: 0,
                        pointHoverRadius: 0
                    }
                ]
            };
            
            console.log('Testing with sample data:', sampleData);
            updateChart(sampleData);
        }
        
        // Initialize when page loads
        window.addEventListener('load', function() {
            console.log('Page loaded, initializing chart...');
            initializeChart();
            
            // Try to load real data after 1 second
            setTimeout(() => {
                loadRealChartData();
            }, 1000);
        });
    </script>
</body>
</html>
